'use strict';var socket,username;function parseMarkdown(a){const b=a.replace(/^### (.*$)/gim,"<h3>$1</h3>").replace(/^## (.*$)/gim,"<h2>$1</h2>").replace(/^# (.*$)/gim,"<h1>$1</h1>").replace(/^\&gt; (.*$)/gim,"<blockquote>$1</blockquote>").replace(/\*\*(.*)\*\*/gim,"<b>$1</b>").replace(/\*(.*)\*/gim,"<i>$1</i>").replace(/!\[(.*?)\]\((.*?)\)/gim,"<img alt='$1' src='$2' />").replace(/\[(.*?)\]\((.*?)\)/gim,"<a href='$2'>$1</a>").replace(/\n$/gim,"<br />");return b.trim()}var showupdate=async()=>{await fetch("update.md").then(a=>a.text()).then(a=>{a!=localStorage.getItem("update")&&(localStorage.setItem("update",a),popup({height:500,html:!0,modal:!0,title:"Updates",buttons:{Close:()=>{$("#dialog").dialog("close")}}},parseMarkdown(escape(a))))})};window.onload=async()=>{try{localStorage?(()=>{null===localStorage.getItem("username")?(()=>{"use strict";var a=!1;popup({beforeClose:()=>a,modal:!0,html:!0,title:"Welcome",buttons:{Go:()=>{localStorage.setItem("username",""===$("#username")[0].value?"user":$("#username")[0].value),username=localStorage.username,a=!0,$("#dialog").dialog("close"),showupdate()}}},`<input id="username" style="width:100%;" placeholder="Please enter your username" type="text">`)})():(()=>{username=localStorage.username,showupdate()})()})():(()=>{popup({beforeClose:()=>!1,modal:!0,title:"Error"},`Your browser is incompatable with WebSenger (You don't support localStorage)`)})(),socket=io(),socket.on("recieve",a=>{a.id!==socket.id&&($("#chatmsgs").append(uiMsg(a.message,1)),$(".msg-them").prev(".msg-you").each((a,b)=>$(b).css("border-bottom-right-radius","30px")))}),socket.on("alert",a=>alert(a)),socket.on("join",(a,b,c,d)=>{$("#Header2>*:nth-child(1)").text(a),$("#chatmsgs").html(""),c||$("#Rooms").prepend(uiRoom(a,b,d))}),socket.on("created",(a,b)=>socket.emit("join",a,username,b,0,!0)),socket.on("deleted",a=>{$("#Header2>*:nth-child(1)").text()==a&&($("#Header2>*:nth-child(1)").text("None"),$("#chatmsgs").html("")),removeRoomByName(a)});var a=new URLSearchParams(location.search);a.has("username")&&a.has("room")&&a.get("room")&&a.has("pass")&&(socket.emit("join",a.get("room"),a.get("username"),a.get("pass")?a.get("pass"):"",0,!1),username=a.get("username"))}catch(a){popup({beforeClose:()=>!1,modal:!0,title:"Error"},`Please open WebSenger in another tab (not the spotlight page)`)}};var popup=(a,b)=>{"use strict";a.html&&$("#dialog").html(b),a.html||$("#dialog").text(b),$("#dialog").dialog(a)},removeRoomByName=a=>{var b=[];for(const c of Array.from($("#Rooms")[0].children))Array.from($("#Rooms")[0].children).indexOf(c)!=Array.from($("#Rooms")[0].children).length-1&&b.push(c.children[0].innerText);b.includes(a)&&$(Array.from($("#Rooms")[0].children)[b.indexOf(a)]).remove()},escape=a=>{"use strict";var b=document.createElement("textarea");b.textContent=a;var c=b.innerHTML;return b.remove(),c},stopPropagation=()=>{"use strict";var a;a||(a=window.event),a.cancelBubble=!0,a.stopPropagation&&a.stopPropagation()},uiRoom=(a,b,c)=>`<div class="room" onclick="room_join(this)"><span>${a}</span><i onclick="${c?"room_delete(this)":"room_leave(this)"}" style="cursor:pointer;" class="fa-duotone fa-octagon-xmark"></i><br><span onclick="stopPropagation();navigator.clipboard.writeText('https://websenger.elijah629.repl.co/join?room=${a}&pass=${b}');" style="cursor:pointer;">Copy Link</span><span>${b}</span></div>`,room_leave=a=>{stopPropagation(),$(a.parentNode).remove(),socket.emit("leave",a.parentNode.children[0].innerText)},room_delete=a=>{stopPropagation(),$(a.parentNode).remove(),socket.emit("delete",a.parentNode.children[0].innerText)},uiMsg=(a,b=0)=>`<li class=\"${0===b?"msg-you":"msg-them"}\">${a}</li>`,send=(a,b)=>{if(13==a.keyCode&&""!=b.value){var c=parseMarkdown(escape(b.value));$("#chatmsgs").append(uiMsg(c,0)),socket.emit("send",{message:c,id:socket.id}),$(".msg-you").prev(".msg-them").each((a,b)=>$(b).css("border-bottom-left-radius","30px")),b.value=""}},room_add=()=>{"use strict";popup({width:500,title:"Add Room",html:!0,modal:!0,buttons:{Create:()=>{""!=$("#DRoomName")[0].value&&(socket.emit("create",$("#DRoomName")[0].value,$("#DPasscode")[0].value),$("#dialog").dialog("close"))},Cancel:()=>{$("#dialog").dialog("close")}}},`<div><input id="DRoomName" placeholder="Room Name" style="width:100%;" type="text"><br/><input id="DPasscode" placeholder="Passcode (Leave empty if none)" style="width:100%;" type="text"></div>`)},room_join=a=>{"use strict";stopPropagation(),$("#chatmsgs").html(""),$("#Header2>*:nth-child(1)").text(a.children[0].innerText),socket.emit("join",a.children[0].innerText,username,a.children[4].innerText,1,!1)},room_connect=()=>{"use strict";popup({title:"Connect to room",html:!0,width:500,modal:!0,buttons:{Connect:()=>{""!=$("#CRoomName")[0].value&&(socket.emit("join",$("#CRoomName")[0].value,username,$("#CPasscode")[0].value,0),$("#Header2>*:nth-child(1)").text($("#CRoomName")[0].value),$("#dialog").dialog("close"))},Cancel:()=>{$("#dialog").dialog("close")}}},`<div><input id="CRoomName" placeholder="Room Name" style="width:100%;" type="text"><br/><input id="CPasscode" placeholder="Passcode (Leave empty if none)" style="width:100%;" type="text"></div>`)};